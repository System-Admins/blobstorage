<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src  'self';
                 style-src   'self' 'unsafe-inline';
                 img-src     'self' data: blob:;
                 connect-src 'self' https://*.blob.core.windows.net https://login.microsoftonline.com https://management.azure.com https://graph.microsoft.com;
                 frame-src   'none';
                 object-src  'none';
                 base-uri    'self';" />
  <!-- X-Content-Type-Options must be set as an HTTP response header on your server/CDN, not as a meta tag -->
  <title>Blob Browser</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- â”€â”€ Loading overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- â”€â”€ Sign-in page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="signInPage" class="sign-in-page hidden">
    <button id="signInThemeToggleBtn" class="theme-toggle sign-in-theme-toggle" title="Toggle dark / light theme" aria-label="Toggle dark or light theme">ğŸŒ™</button>
    <div class="sign-in-card">
      <div class="app-logo">â˜ï¸</div>
      <h1>Blob Browser</h1>
      <p>Sign in with your Microsoft account to browse your storage container.</p>
      <button id="signInBtn" class="btn btn-primary">
        Sign in with Microsoft
      </button>
      <div class="sign-in-divider"><span>or</span></div>
      <button id="openSasSignInBtn" class="btn btn-secondary">
        ğŸ”‘ Open SAS URL
      </button>
    </div>
  </div>

  <!-- â”€â”€ Storage picker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="pickerPage" class="picker-page hidden">
    <header class="picker-header">
      <div class="picker-header-left">
        <span class="header-logo">â˜ï¸</span>
        <h1 class="header-title">Blob Browser</h1>
      </div>
      <div class="picker-header-right">
        <button id="pickerThemeToggleBtn" class="theme-toggle" title="Toggle dark / light theme" aria-label="Toggle dark or light theme">ğŸŒ™</button>
        <button id="pickerBackBtn" class="btn btn-secondary hidden" title="Return to current container">â† Back to explorer</button>
        <button id="pickerSignOutBtn" class="btn btn-secondary" title="Sign out">ğŸšª <span class="btn-label">Sign out</span></button>
      </div>
    </header>

    <!-- Sub-header: user identity (matches explorer page layout) -->
    <div class="header-info-bar" id="pickerInfoBar">
      <div class="header-info-bar-right">
        <div class="user-info">
          <span class="user-name" id="pickerInfoBarName"></span>
        </div>
      </div>
    </div>

    <div class="picker-body">
      <div class="picker-title-row">
        <h2 class="picker-heading">Select a storage container</h2>
        <input type="search" id="pickerSearch" class="picker-search" placeholder="ğŸ” Filter accounts &amp; containersâ€¦" />
      </div>

      <div id="pickerSubList" class="picker-sub-list">
        <!-- Subscription groups injected by JS -->
      </div>

      <div id="pickerEmpty" class="picker-empty hidden">
        <div class="empty-icon">ğŸ—„ï¸</div>
        <p>No storage accounts found.<br>Make sure you have a Storage data-plane role on at least one account.</p>
      </div>

      <div id="pickerError" class="picker-error hidden"></div>

      <p class="picker-cors-hint">
        â„¹ï¸ Not seeing all your storage accounts? Accounts without a CORS rule that permits
        <strong id="pickerOriginHint"></strong> are hidden automatically.
        Ask your administrator to add your origin under
        <em>Azure Portal â†’ Storage Account â†’ Resource sharing (CORS) â†’ Blob service</em>.
      </p>
    </div>
  </div>

  <!-- â”€â”€ Main application â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="mainApp" class="main-app hidden">

    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <span class="header-logo">â˜ï¸</span>
        <h1 class="header-title">Blob Browser</h1>
        <span class="header-subtitle" id="storageInfo"></span>
      </div>
      <div class="header-right">
        <button id="themeToggleBtn" class="theme-toggle" title="Toggle dark / light theme" aria-label="Toggle dark or light theme">ğŸŒ™</button>
        <button id="changeStorageBtn" class="btn btn-secondary" title="Switch storage account or container">ğŸ—„ï¸ <span class="btn-label">Change</span></button>
        <button id="helpBtn" class="btn btn-secondary" title="Help">â“ <span class="btn-label">Help</span></button>
        <button id="signOutBtn" class="btn btn-secondary" title="Sign out">ğŸšª <span class="btn-label">Sign out</span></button>
      </div>
    </header>

    <!-- Sub-header: user identity & permission badge -->
    <div class="header-info-bar hidden" id="headerInfoBar">
      <div class="header-info-bar-right">
        <span id="permBadge" class="perm-badge hidden"></span>
        <div class="user-info" id="userInfo">
          <span class="user-name" id="userDisplayName"></span>
        </div>
      </div>
    </div>

    <!-- App body: folder tree sidebar + content column -->
    <div class="app-body">
      <nav id="folderTree" class="folder-tree" aria-label="Folder navigation tree">
        <div class="tree-header">
          <span class="tree-header-label">Tree view</span>
          <div class="tree-header-actions">
            <button id="treeExpandAllBtn"   class="btn btn-icon btn-small" title="Expand all" aria-label="Expand all">&#8853;</button>
            <button id="treeCollapseAllBtn" class="btn btn-icon btn-small" title="Collapse all" aria-label="Collapse all">&#8854;</button>
          </div>
        </div>
        <div id="treeRoot" class="tree-root"></div>
      </nav>

      <div class="app-content-col">
        <!-- Breadcrumb navigation -->
        <nav class="breadcrumb-nav" aria-label="Folder navigation">
          <ol id="breadcrumb" class="breadcrumb"></ol>
        </nav>

        <!-- Toolbar -->
        <div class="toolbar" role="toolbar" aria-label="View controls">
          <div class="toolbar-left">
            <button id="treeToggleBtn" class="btn btn-icon active" title="Toggle folder tree">&#9664; <span class="btn-label">Tree</span></button>
            <button id="upBtn" class="btn btn-icon hidden" title="Go up one level" aria-label="Go up one level">&#8593; <span class="btn-label">Up</span></button>
            <span id="itemCount" class="item-count"></span>
          </div>
          <div class="toolbar-right">
            <button id="newBtn"         class="btn btn-upload hidden" title="Create new folder or file">&#xff0b; <span class="btn-label">New</span></button>
            <button id="uploadBtn"      class="btn btn-upload hidden" title="Upload files or folders">â¬† <span class="btn-label">Upload</span></button>
            <button id="downloadAllBtn" class="btn btn-upload"        title="Download current folder as ZIP">â¬‡ <span class="btn-label">Download</span></button>
            <button id="infoBtn"        class="btn btn-icon"          title="Current location info">â„¹ï¸ <span class="btn-label">Info</span></button>
            <button id="searchBtn"  class="btn btn-icon"          title="Search files and folders">ğŸ” <span class="btn-label">Search</span></button>
            <button id="reportBtn"  class="btn btn-icon"          title="Export CSV report">ğŸ“Š <span class="btn-label">Report</span></button>
            <button id="refreshBtn" class="btn btn-icon"          title="Refresh">â†» <span class="btn-label">Refresh</span></button>
            <div class="view-toggle" role="group" aria-label="View mode">
              <button id="listViewBtn" class="btn btn-icon active" title="List view" aria-pressed="true">â˜° <span class="btn-label">List</span></button>
              <button id="gridViewBtn" class="btn btn-icon"        title="Grid view" aria-pressed="false">âŠ <span class="btn-label">Grid</span></button>
            </div>
          </div>
        </div>

        <!-- Search bar (shown/hidden via the ğŸ” toolbar button) -->
        <div class="search-bar hidden" id="searchBar">
          <div class="search-input-group">
            <input type="search" id="searchInput" class="search-input" placeholder="Search files and foldersâ€¦" autocomplete="off" spellcheck="false" />
            <button id="searchClearBtn" class="btn btn-icon btn-small search-clear hidden" title="Clear">âœ•</button>
          </div>
          <div class="search-scope-group">
            <label class="search-scope-opt">
              <input type="radio" name="searchScope" value="folder" checked />
              <span>Current folder</span>
            </label>
            <label class="search-scope-opt">
              <input type="radio" name="searchScope" value="container" />
              <span>Everything</span>
            </label>
          </div>
        </div>

        <!-- Upload panel (visible only to authorised uploaders) -->
        <div id="uploadPanel" class="upload-panel hidden">
          <div class="upload-dropzone" id="dropZone">
            <div class="dropzone-icon">ğŸ“¤</div>
            <p class="dropzone-text">Drag &amp; drop files here, or use the buttons below</p>
            <p class="dropzone-subtext">Files will be placed in the currently open folder</p>
            <div class="dropzone-actions">
              <button id="pickFilesBtn"  class="btn btn-upload-action">ğŸ“„ Select files</button>
              <button id="pickFolderBtn" class="btn btn-upload-action">ğŸ“ Select folder</button>
            </div>
            <input type="file" id="fileInput"   multiple       hidden />
            <input type="file" id="folderInput" webkitdirectory hidden />
          </div>
          <div id="uploadQueue" class="upload-queue hidden">
            <div class="upload-queue-header">
              <span id="uploadQueueCount" class="upload-queue-count"></span>
              <button id="clearCompletedBtn" class="btn btn-icon btn-small">Clear completed</button>
            </div>
            <div id="uploadQueueList" class="upload-queue-list"></div>
          </div>
        </div>

        <!-- Selection action bar (shown when items are selected) -->
        <div id="selectionBar" class="selection-bar hidden" role="toolbar" aria-label="Selection actions">
          <span id="selectionCount" class="selection-count"></span>
          <div class="selection-actions">
            <button id="selBulkDownloadBtn" class="btn btn-sel-action">&#x2B07; Download</button>
            <button id="selBulkCopyBtn"     class="btn btn-sel-action">&#x1F4CB; Copy</button>
            <button id="selBulkMoveBtn"     class="btn btn-sel-action">&#x1F4E6; Move</button>
            <button id="selBulkDeleteBtn"   class="btn btn-sel-action btn-sel-danger">&#x1F5D1;&#xFE0F; Delete</button>
            <button id="selClearBtn"        class="btn btn-sel-clear">&#x2715; Clear selection</button>
          </div>
        </div>

        <!-- File/folder content -->
        <main id="contentArea" class="content" aria-live="polite">
          <div id="errorMessage" class="error-banner hidden" role="alert"></div>
          <div id="networkErrorHelp" class="network-error-help hidden" role="alert">
            <strong>Connection failed â€” possible causes:</strong>
            <ul class="network-error-list">
              <li>
                <strong>ğŸ”’ Network access is blocked</strong> â€” Ask your administrator to allow your public IP address under<br>
                <em>Azure Portal â†’ Storage Account â†’ Networking</em>
              </li>
              <li>
                <strong>ğŸŒ CORS is not configured</strong> â€” Ask your administrator to add the following origin to the Blob service CORS rules under<br>
                <em>Azure Portal â†’ Storage Account â†’ Resource sharing (CORS) â†’ Blob service</em>:<br>
                <code id="networkErrorOrigin"></code>
              </li>
            </ul>
          </div>
          <div id="searchBanner" class="search-banner hidden"></div>
          <div id="fileContainer"></div>
          <div id="emptyState" class="empty-state hidden">
            <div class="empty-icon">ğŸ“‚</div>
            <p>This folder is empty</p>
          </div>
        </main>
      </div><!-- /.app-content-col -->
    </div><!-- /.app-body -->
    <footer class="app-footer">
      Developed by <a href="https://www.systemadmins.com" target="_blank" rel="noopener noreferrer">System Admins</a> &copy; <span id="footerYear"></span>
    </footer>

  </div><!-- /#mainApp -->
  <!-- â”€â”€ Properties modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="propsModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="propsModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="propsModalTitle">Properties</h2>
        <button class="modal-close" id="propsModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <table class="props-table" id="propsTable"></table>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Rename modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="renameModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="renameModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="renameModalTitle">Rename</h2>
        <button class="modal-close" id="renameModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <label class="rename-label" for="renameInput">New name</label>
        <input type="text" id="renameInput" class="rename-input" spellcheck="false" />
        <p class="rename-error hidden" id="renameError"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="renameCancelBtn">Cancel</button>
        <button class="btn btn-primary-sm"        id="renameConfirmBtn">Rename</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Copy-to modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="copyModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="copyModalTitle">
    <div class="modal" style="max-width:520px">
      <div class="modal-header">
        <h2 class="modal-title" id="copyModalTitle">Copy toâ€¦</h2>
        <button class="modal-close" id="copyModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="font-size:13px;color:var(--text-muted);margin:0 0 10px">Select a destination folder, then click <strong>Copy</strong>.</p>
        <div id="copyTreeContainer" class="copy-tree-container"></div>
        <label class="rename-label" for="copyDestInput" style="margin-top:12px">Destination path</label>
        <input type="text" id="copyDestInput" class="rename-input" spellcheck="false" placeholder="folder/subfolder/" />
        <p class="rename-error hidden" id="copyError"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="copyCancelBtn">Cancel</button>
        <button class="btn btn-primary-sm"        id="copyConfirmBtn">ğŸ“‹ Copy</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Delete confirmation modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="deleteModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="deleteModalTitle">Confirm delete</h2>
        <button class="modal-close" id="deleteModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <p id="deleteModalMsg" style="font-size:14px;line-height:1.6;"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="deleteCancelBtn">Cancel</button>
        <button class="btn btn-danger"             id="deleteConfirmBtn">ğŸ—‘ï¸ Delete</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Overwrite conflict modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="overwriteModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="overwriteModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="overwriteModalTitle">âš ï¸ File conflict</h2>
        <button class="modal-close" id="overwriteModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <p id="overwriteModalMsg" style="font-size:14px;line-height:1.6;"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="overwriteCancelBtn">Cancel</button>
        <button class="btn btn-secondary-neutral" id="overwriteSkipBtn">Skip existing</button>
        <button class="btn btn-primary-sm"        id="overwriteConfirmBtn">Overwrite all</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Copy/Move conflict prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="copyConflictModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="copyConflictTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="copyConflictTitle">âš ï¸ Destination already exists</h2>
        <button class="modal-close" id="copyConflictClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <p id="copyConflictMsg" style="font-size:14px;line-height:1.6;"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="copyConflictSkipBtn">Skip</button>
        <button class="btn btn-primary-sm"        id="copyConflictOverwriteBtn">Overwrite</button>
        <button class="btn btn-primary-sm"        id="copyConflictOverwriteAllBtn">Overwrite all</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ File viewer modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="viewModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="viewModalTitle">
    <div class="modal view-modal">
      <div class="modal-header view-modal-header">
        <div class="view-modal-title-group">
          <h2 class="modal-title" id="viewModalTitle"></h2>
          <span id="viewLangBadge" class="view-lang-badge"></span>
        </div>
        <div class="view-modal-actions">
          <button id="viewWrapBtn" class="btn btn-icon btn-small" title="Toggle word wrap">â†µ Wrap</button>
          <button id="viewCopyBtn" class="btn btn-icon btn-small" title="Copy content">ğŸ“‹ Copy</button>
          <button id="viewDlBtn"   class="btn btn-icon btn-small" title="Download">â¬‡ Download</button>
          <button class="modal-close" id="viewModalClose" aria-label="Close">Ã—</button>
        </div>
      </div>
      <div id="viewModalBody" class="modal-body view-modal-body"></div>
      <div class="modal-footer view-modal-footer">
        <span id="viewFileMeta" class="view-file-meta"></span>
        <button class="btn btn-secondary-neutral" id="viewCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ File editor modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="editModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="editModalTitle">
    <div class="modal view-modal">
      <div class="modal-header view-modal-header">
        <div class="view-modal-title-group">
          <h2 class="modal-title" id="editModalTitle"></h2>
          <span id="editLangBadge" class="view-lang-badge"></span>
        </div>
        <div class="view-modal-actions">
          <button id="editSaveBtn" class="btn btn-primary-sm">ğŸ’¾ Save</button>
          <button class="modal-close" id="editModalClose" aria-label="Close">Ã—</button>
        </div>
      </div>
      <div class="modal-body edit-modal-body">
        <textarea id="editContent" class="edit-textarea" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"></textarea>
      </div>
      <div class="modal-footer view-modal-footer">
        <span id="editFileMeta" class="view-file-meta"></span>
        <button class="btn btn-secondary-neutral" id="editCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- â”€â”€ New item modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="newModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="newModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="newModalTitle">New</h2>
        <button class="modal-close" id="newModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="new-type-toggle" role="group" aria-label="Item type">
          <button class="new-type-btn active" id="newTypeFolderBtn">ğŸ“ Folder</button>
          <button class="new-type-btn" id="newTypeFileBtn">ğŸ“„ File</button>
        </div>
        <label class="rename-label" for="newNameInput" id="newNameLabel">Folder name</label>
        <input type="text" id="newNameInput" class="rename-input" spellcheck="false" placeholder="my-folder" />
        <div id="newFileContentWrap" class="hidden" style="margin-top:12px">
          <label class="rename-label" for="newFileContent">Content <span style="font-weight:400;color:var(--text-muted)">(optional)</span></label>
          <textarea id="newFileContent" class="rename-input new-file-textarea" spellcheck="false" placeholder="File contentâ€¦"></textarea>
        </div>
        <p class="rename-error hidden" id="newModalError"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="newCancelBtn">Cancel</button>
        <button class="btn btn-primary-sm" id="newConfirmBtn">Create</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Location info modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="infoModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="infoModalTitle">Location info</h2>
        <button class="modal-close" id="infoModalClose" aria-label="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <table class="props-table" id="infoTable"></table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="infoCloseBtn">Close</button>
      </div>
    </div>
  </div>


  <!-- â”€â”€ SAS generator modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sasModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="sasModalTitle">
    <div class="modal modal-wide">
      <div class="modal-header">
        <h2 class="modal-title" id="sasModalTitle">Generate SAS</h2>
        <button class="modal-close" id="sasModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <p id="sasItemInfo" class="sas-item-info"></p>
        <div class="sas-form">
          <div class="sas-row">
            <div class="sas-field">
              <label class="rename-label" for="sasStart">Start <span class="sas-hint">(local time &mdash; leave blank to start immediately)</span></label>
              <input type="datetime-local" id="sasStart" class="rename-input sas-datetime" />
            </div>
            <div class="sas-field">
              <label class="rename-label" for="sasExpiry">Expiry <span class="sas-required">*</span> <span class="sas-hint">(local time)</span></label>
              <input type="datetime-local" id="sasExpiry" class="rename-input sas-datetime" required />
            </div>
          </div>
          <div class="sas-row">
            <div class="sas-field sas-field-full">
              <label class="rename-label" for="sasIp">Allowed IP / range <span class="sas-hint">(e.g. 1.2.3.4 or 1.2.3.0&ndash;1.2.3.255 &mdash; leave blank for any)</span></label>
              <input type="text" id="sasIp" class="rename-input" placeholder="Any IP address" spellcheck="false" />
            </div>
          </div>
          <div class="sas-row">
            <div class="sas-field sas-field-full">
              <label class="rename-label">Permissions</label>
              <div id="sasPermissions" class="sas-perm-group"></div>
            </div>
          </div>
        </div>
        <p class="sas-folder-note hidden" id="sasFolderNote">
          &#x2139;&#xFE0F; Folder SAS is issued at container scope &mdash; it grants access to <em>all blobs</em> in this container, not just the selected folder.
        </p>
        <p class="rename-error hidden" id="sasError"></p>
        <div id="sasResultWrap" class="sas-result-wrap hidden">
          <label class="rename-label">Generated SAS URL</label>
          <div class="sas-result-row">
            <textarea id="sasResult" class="rename-input sas-result-textarea" readonly spellcheck="false"></textarea>
            <button class="btn btn-icon btn-small sas-copy-btn" id="sasCopyBtn" title="Copy SAS URL">&#x1F4CB; Copy</button>
            <button class="btn btn-icon btn-small sas-email-btn hidden" id="sasEmailBtn" title="Email SAS URL">&#x1F4E7; Email</button>
          </div>
          <p class="sas-expires-note" id="sasExpiresNote"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="sasCancelBtn">Close</button>
        <button class="btn btn-primary-sm" id="sasGenerateBtn">&#x1F511; Generate</button>
      </div>
    </div>
  </div>
  <!-- â”€â”€ Help modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="helpModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
    <div class="modal modal-wide">
      <div class="modal-header">
        <h2 class="modal-title" id="helpModalTitle">â“ Help &amp; User Guide</h2>
        <button class="modal-close" id="helpModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body help-modal-body">

        <div class="help-section">
          <h3 class="help-heading">ğŸ“‹ Overview</h3>
          <p>Blob Browser lets you browse, download, upload, and manage files stored in an Azure Blob Storage container â€” directly from your browser, without any additional software.</p>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ğŸ” Signing in &amp; permissions</h3>
          <ul class="help-list">
            <li>Sign in with your Microsoft (Entra ID) account using the <strong>Sign in with Microsoft</strong> button.</li>
            <li>Your access level is shown as a badge in the top-right corner:<br>
              <span class="help-badge help-badge-reader">ğŸ“– Reader</span> â€” you can browse and download files.<br>
              <span class="help-badge help-badge-writer">&#9999;&#xFE0F; Writer</span> â€” you can also upload, create, rename and delete files.
            </li>
            <li>If you need more access, contact your administrator to adjust your Azure role assignment.</li>
            <li>Alternatively, use <strong>ğŸ”‘ Open SAS URL</strong> to browse a container or file using a Shared Access Signature URL provided by an administrator.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ğŸ“‚ Navigating folders</h3>
          <ul class="help-list">
            <li>Click a folder in the file list to open it.</li>
            <li>Use the <strong>breadcrumb bar</strong> at the top to jump back to any parent folder.</li>
            <li>Use the <strong>Tree view</strong> sidebar on the left to jump directly to any folder.</li>
            <li>The <strong>â†‘ Up</strong> toolbar button takes you to the parent folder of the current location.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ğŸ‘ï¸ Viewing &amp; downloading files</h3>
          <ul class="help-list">
            <li>Click any file to preview it (text, code, images, PDF, video and audio files are supported).</li>
            <li>Use the <strong>â¬‡ Download</strong> button on a file row to save it to your computer.</li>
            <li>Use the <strong>â¬‡ Download</strong> toolbar button to download everything in the current folder as a ZIP archive.</li>
            <li>Select multiple files using the checkboxes, then choose <strong>â¬‡ Download</strong> in the selection bar to download them all as a ZIP.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">â¬†ï¸ Uploading files <span class="help-requires-writer">(Writer role required)</span></h3>
          <ul class="help-list">
            <li>Click the <strong>â¬† Upload</strong> toolbar button to open the upload panel.</li>
            <li>Drag &amp; drop files or folders directly onto the panel, or use <strong>Select files</strong> / <strong>Select folder</strong>.</li>
            <li>Files are uploaded into the folder you are currently browsing.</li>
            <li>If a file with the same name exists, you will be asked whether to overwrite or skip it.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">â• Creating files &amp; folders <span class="help-requires-writer">(Writer role required)</span></h3>
          <ul class="help-list">
            <li>Click <strong>&#xff0b; New</strong> in the toolbar to create a new folder or a new text file in the current location.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">âœï¸ Renaming &amp; deleting <span class="help-requires-writer">(Writer role required)</span></h3>
          <ul class="help-list">
            <li>Hover over any file or folder row and use the action buttons that appear on the right.</li>
            <li>To delete multiple items at once, select them with the checkboxes and click <strong>ğŸ—‘ï¸ Delete</strong> in the selection bar.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ğŸ” Searching</h3>
          <ul class="help-list">
            <li>Click the <strong>ğŸ” Search</strong> toolbar button to open the search bar.</li>
            <li><strong>Current folder</strong> â€” filters the files and folders visible in the current location.</li>
            <li><strong>Everything</strong> â€” searches every file and folder name across the entire container.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ï¿½ Sharing links &amp; emailing</h3>
          <ul class="help-list">
            <li>Click the <strong>ğŸ”— Copy URL</strong> button on any file or folder to copy a direct blob URL or an app link.</li>
            <li>If you are signed in with a Microsoft account that has an <strong>Exchange Online</strong> license, you can also send the link directly via email from the same menu.</li>
            <li>When generating a <strong>SAS token</strong>, the generated URL can also be emailed using the <strong>ğŸ“§ Email</strong> button.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ğŸ”‘ Opening a SAS URL</h3>
          <ul class="help-list">
            <li>Click <strong>ğŸ”‘ Open SAS URL</strong> in the header (or on the sign-in page) and paste in a SAS URL provided by your administrator.</li>
            <li>The application will automatically detect what the SAS permits (list, read, write, delete) and adjust the available actions accordingly.</li>
            <li>Click <strong>Disconnect</strong> to leave SAS mode and return to your normal session.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">ğŸŒ™ Dark mode</h3>
          <ul class="help-list">
            <li>Click the <strong>ğŸŒ™ / â˜€ï¸</strong> button in the header to toggle between dark and light themes.</li>
            <li>By default, Blob Browser follows your operating system's appearance setting.</li>
            <li>Your preference is remembered across sessions.</li>
          </ul>
        </div>

        <div class="help-section">
          <h3 class="help-heading">âŒ¨ï¸ Keyboard shortcuts</h3>
          <table class="shortcut-table">
            <tr><td><kbd>Ctrl</kbd> + <kbd>K</kbd></td><td>Open / close search</td></tr>
            <tr><td><kbd>Ctrl</kbd> + <kbd>U</kbd></td><td>Toggle upload panel</td></tr>
            <tr><td><kbd>Backspace</kbd></td><td>Navigate to parent folder</td></tr>
            <tr><td><kbd>F5</kbd></td><td>Refresh file listing</td></tr>
            <tr><td><kbd>?</kbd></td><td>Open this help dialog</td></tr>
            <tr><td><kbd>Escape</kbd></td><td>Close any open dialog</td></tr>
          </table>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="helpCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Open SAS modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="openSasModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="openSasModalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="openSasModalTitle">Open SAS URL</h2>
        <button class="modal-close" id="openSasModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <p class="open-sas-desc">Paste a Shared Access Signature (SAS) URL to browse a container, folder or file without signing in.</p>
        <label class="rename-label" for="openSasInput">SAS URL</label>
        <textarea id="openSasInput" class="rename-input open-sas-textarea" spellcheck="false" placeholder="https://account.blob.core.windows.net/container?sp=rl&amp;st=...&amp;sig=..."></textarea>
        <div id="openSasParsed" class="open-sas-parsed hidden">
          <table class="props-table open-sas-info-table">
            <tr><td class="props-label">Account</td><td class="props-value" id="openSasAccount"></td></tr>
            <tr><td class="props-label">Container</td><td class="props-value" id="openSasContainer"></td></tr>
            <tr><td class="props-label">Path</td><td class="props-value" id="openSasPath"></td></tr>
            <tr><td class="props-label">Permissions</td><td class="props-value" id="openSasPerms"></td></tr>
            <tr><td class="props-label">Valid from</td><td class="props-value" id="openSasStart"></td></tr>
            <tr><td class="props-label">Expires</td><td class="props-value" id="openSasExpiry"></td></tr>
            <tr><td class="props-label">Resource</td><td class="props-value" id="openSasResource"></td></tr>
          </table>
        </div>
        <p class="rename-error hidden" id="openSasError"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="openSasCancelBtn">Cancel</button>
        <button class="btn btn-primary-sm" id="openSasOpenBtn" disabled>ğŸ”‘ Open</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Email compose modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="emailModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="emailModalTitle">
    <div class="modal email-modal">
      <div class="modal-header">
        <h2 class="modal-title" id="emailModalTitle">ğŸ“§ Send link via email</h2>
        <button class="modal-close" id="emailModalClose" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" for="emailTo">To <span class="form-hint">(separate multiple with ; or ,)</span></label>
          <input class="form-input" type="text" id="emailTo" placeholder="recipient@example.com" autocomplete="email" />
        </div>
        <div class="form-group">
          <label class="form-label" for="emailSubject">Subject</label>
          <input class="form-input" type="text" id="emailSubject" />
        </div>
        <div class="form-group">
          <label class="form-label" for="emailBody">Message</label>
          <textarea class="form-input email-body-textarea" id="emailBody" rows="6"></textarea>
        </div>
        <p id="emailError" class="form-error hidden"></p>
        <p id="emailSending" class="form-hint hidden">â³ Sendingâ€¦</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary-neutral" id="emailCancelBtn">Cancel</button>
        <button class="btn btn-primary-sm" id="emailSendBtn">ğŸ“¨ Send</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Toast notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
  <!-- â”€â”€ Scripts (order matters) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script src="config.js"></script>
  <script src="auth.js"></script>
  <script src="arm.js"></script>
  <script src="storage.js"></script>
  <script src="app.js"></script>

</body>
</html>
